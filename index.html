<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ESSENCE | Luxury Management</title>
    
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>
    <script type="text/javascript">
       (function(){
          emailjs.init("bPgMuFdLjStHvDuBQ"); 
       })();
    </script>

    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700&family=Inter:wght@300;400;700&display=swap" rel="stylesheet">
    <style>
        :root { --gold: #b8952e; --black: #000; --white: #fff; --gray: #f9f9f9; --border: #eeeeee; }
        body { font-family: 'Inter', sans-serif; background: var(--white); color: var(--black); margin: 0; }
        nav { display: flex; justify-content: space-between; align-items: center; padding: 20px 8%; border-bottom: 1px solid var(--border); position: sticky; top: 0; background: #fff; z-index: 1000; }
        .logo { font-family: 'Cinzel'; font-size: 1.8rem; letter-spacing: 6px; cursor: pointer; user-select: none; }
        .user-bar { background: var(--gray); padding: 8px 8%; display: flex; justify-content: space-between; font-size: 0.65rem; border-bottom: 1px solid var(--border); }
        .pts-badge { color: var(--gold); font-weight: 700; background: #fff; padding: 2px 8px; border-radius: 10px; border: 1px solid var(--border); }
        .container { max-width: 1300px; margin: 40px auto; padding: 0 5%; }
        .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(260px, 1fr)); gap: 40px; }
        .p-card { text-align: center; padding: 15px; }
        .img-box { background: var(--gray); aspect-ratio: 1/1; display: flex; align-items: center; justify-content: center; margin-bottom: 15px; overflow: hidden; }
        .img-box img { max-width: 90%; max-height: 90%; object-fit: contain; mix-blend-mode: multiply; }
        .btn { border: 1px solid var(--black); background: transparent; padding: 12px; cursor: pointer; font-size: 0.65rem; letter-spacing: 2px; width: 100%; text-transform: uppercase; font-weight: 700; }
        .btn:hover { background: var(--black); color: var(--white); }
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(255,255,255,0.98); z-index: 2000; align-items: center; justify-content: center; }
        .modal-content { width: 90%; max-width: 350px; text-align: center; padding: 40px; border: 1px solid #eee; background: #fff; }
        #bossPanel { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #fff; z-index: 3000; padding: 40px; overflow-y: auto; }
        input, select { width: 100%; padding: 12px; margin: 10px 0; border: 1px solid var(--border); box-sizing: border-box; }
    </style>
</head>
<body>

<div class="user-bar">
    <span id="uNameTop">BIENVENIDO A ESSENCE</span>
    <span id="uPtsTop">PUNTOS: <span class="pts-badge">0</span></span>
</div>

<nav>
    <div class="logo" id="logoBtn">ESSENCE</div>
    <div id="navAction"><span onclick="openM('modalReg')" style="cursor:pointer; font-size:0.65rem; font-weight:700;">REGISTRO</span></div>
</nav>

<div class="container">
    <div id="mainGrid" class="grid"></div>
</div>

<div id="bossPanel">
    <button class="btn" style="width:auto; float:right;" onclick="location.reload()">CERRAR</button>
    <h2 style="font-family:Cinzel;">ADMINISTRACIÓN JEFE</h2>
    <input id="pName" placeholder="Nombre">
    <input id="pPrice" type="number" placeholder="Precio">
    <input id="pImg" placeholder="Link de Foto">
    <button class="btn" onclick="addP()">PUBLICAR EN TIENDA</button>
</div>

<div id="modalBuy" class="modal">
    <div class="modal-content">
        <h2 style="font-family:Cinzel;">MÉTODO DE ENTREGA</h2>
        <select id="deliveryOption">
            <option value="Envio Contraentrega">Envio Contraentrega</option>
            <option value="Envio Pago">Envio Pago</option>
            <option value="Retiro en Tienda">Retiro en Tienda</option>
        </select>
        <button class="btn" onclick="confirmOrder()">CONFIRMAR WHATSAPP</button>
        <p onclick="closeM('modalBuy')" style="font-size:0.6rem; cursor:pointer; margin-top:15px;">CANCELAR</p>
    </div>
</div>

<div id="modalReg" class="modal">
    <div class="modal-content" id="step1">
        <h2 style="font-family:Cinzel;">ACCESO VIP</h2>
        <input id="regName" placeholder="Nombre">
        <input id="regEmail" placeholder="Correo">
        <button class="btn" onclick="sendGmailCode()">RECIBIR CÓDIGO</button>
    </div>
    <div class="modal-content" id="step2" style="display:none;">
        <h2 style="font-family:Cinzel;">VERIFICACIÓN</h2>
        <input id="regCode" placeholder="Código de 4 dígitos">
        <button class="btn" onclick="completeReg()">ACTIVAR</button>
    </div>
</div>

<script>
    const SERVICE_ID = "Essencepty"; 
    const TEMPLATE_ID = "template_buhgfdi";
    const WHATSAPP_NUMBER = "50762143714";

    let catalog = JSON.parse(localStorage.getItem('ess_catalog')) || [{n:"Prueba", p:0, i:""}];
    let session = JSON.parse(localStorage.getItem('ess_session')) || null;
    let currentItem = null;
    let generatedCode = null;
    let bossClicks = 0;

    function renderShop() {
        document.getElementById('mainGrid').innerHTML = catalog.map(p => `
            <div class="p-card">
                <div class="img-box"><img src="${p.i || 'https://via.placeholder.com/200'}"></div>
                <h4>${p.n}</h4>
                <b>$${session ? p.p : '---'}.00</b>
                <button class="btn" style="margin-top:10px;" onclick="buyAction('${p.n}', ${p.p})">${session ? 'COMPRAR' : 'REGISTRATE'}</button>
            </div>`).join('');
    }

    window.sendGmailCode = () => {
        const email = document.getElementById('regEmail').value;
        const name = document.getElementById('regName').value;
        generatedCode = Math.floor(1000 + Math.random() * 9000).toString();
        emailjs.send(SERVICE_ID, TEMPLATE_ID, { to_name: name, user_email: email, code: generatedCode })
            .then(() => {
                alert("Código enviado!");
                document.getElementById('step1').style.display='none';
                document.getElementById('step2').style.display='block';
            });
    };

    window.completeReg = () => {
        if(document.getElementById('regCode').value === generatedCode) {
            session = { n: document.getElementById('regName').value };
            localStorage.setItem('ess_session', JSON.stringify(session));
            location.reload();
        } else { alert("Código incorrecto"); }
    };

    window.buyAction = (n, p) => { if(!session) return openM('modalReg'); currentItem = {n, p}; openM('modalBuy'); };

    window.confirmOrder = () => {
        const opt = document.getElementById('deliveryOption').value;
        const text = encodeURIComponent(`Hola! Quiero el ${currentItem.n}. Método: ${opt}. Cliente: ${session.n}`);
        window.open(`https://wa.me/${WHATSAPP_NUMBER}?text=${text}`);
    };

    window.addP = () => {
        const n = document.getElementById('pName').value;
        const p = document.getElementById('pPrice').value;
        const i = document.getElementById('pImg').value;
        if(n && p) {
            catalog.push({n, p, i});
            localStorage.setItem('ess_catalog', JSON.stringify(catalog));
            renderShop();
            alert("Publicado!");
        }
    };

    document.getElementById('logoBtn').onclick = () => {
        bossClicks++;
        if(bossClicks >= 3) {
            if(prompt("PASS:") === "0000") document.getElementById('bossPanel').style.display='block';
            bossClicks = 0;
        }
    };

    window.openM = (id) => document.getElementById(id).style.display='flex';
    window.closeM = (id) => document.getElementById(id).style.display='none';

    if(session) {
        document.getElementById('uNameTop').innerText = "BIENVENIDO: " + session.n.toUpperCase();
        document.getElementById('navAction').style.display = 'none';
    }
    renderShop();
</script>
</body>
</html>
</body>

</html>

