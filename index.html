<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ESSENCE OMNIVERSE</title>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@700&family=Inter:wght@300;400;700&display=swap" rel="stylesheet">
    <style>
        :root { --gold: #c5a059; --b: #000; --w: #fff; --gray: #f9f9f9; }
        * { margin:0; padding:0; box-sizing:border-box; font-family:'Inter', sans-serif; -webkit-tap-highlight-color: transparent; }
        body { background: var(--w); color: var(--b); line-height: 1.6; }

        /* HEADER LIMPIO */
        header { background: var(--b); padding: 25px 15px; text-align: center; position: sticky; top: 0; z-index: 1000; }
        .logo { font-family: 'Cinzel'; font-size: 1.6rem; letter-spacing: 10px; color: var(--w); cursor: pointer; }
        
        .search-container { max-width: 500px; margin: 15px auto 0; width: 95%; }
        .search-input { width: 100%; padding: 12px 20px; border-radius: 8px; border: none; background: #1a1a1a; color: #fff; font-size: 0.85rem; outline: none; text-align: center; }

        /* NAVEGACIÃ“N */
        nav { display: flex; background: var(--w); border-bottom: 1px solid #eee; position: sticky; top: 118px; z-index: 999; }
        .nav-btn { flex: 1; padding: 15px; font-size: 0.65rem; font-weight: 700; text-transform: uppercase; cursor: pointer; border: none; background: none; color: #999; letter-spacing: 1px; }
        .nav-btn.active { color: #000; border-bottom: 2px solid #000; }

        /* SECCIONES */
        .section { display: none; padding: 20px 10px; max-width: 1200px; margin: 0 auto; animation: fadeIn 0.4s ease; }
        .section.active { display: block; }
        @keyframes fadeIn { from {opacity: 0;} to {opacity: 1;} }

        /* GRID OPTIMIZADO PARA MÃ“VIL */
        .grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px; }
        .card { background: var(--w); border: 1px solid #f0f0f0; border-radius: 4px; padding: 8px; text-align: center; position: relative; }
        .card img { width: 100%; aspect-ratio: 1/1; object-fit: contain; margin-bottom: 8px; background: var(--gray); border-radius: 4px; }
        .card-name { font-weight: 700; font-size: 0.7rem; text-transform: uppercase; margin-bottom: 4px; display: block; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
        .card-price { color: var(--gold); font-size: 0.9rem; font-weight: 300; margin-bottom: 10px; display: block; }

        /* BOTÃ“N DE WHATSAPP DIRECTO */
        .btn-wa { width: 100%; padding: 12px; background: var(--b); color: var(--w); border: none; font-size: 0.6rem; font-weight: 700; letter-spacing: 1px; cursor: pointer; text-transform: uppercase; border-radius: 2px; }
        .card.sold-out { opacity: 0.4; filter: grayscale(1); }
        .sold-out-tag { position: absolute; top: 15px; right: 15px; background: red; color: #fff; padding: 3px 6px; font-size: 0.5rem; font-weight: 900; }

        /* DASHBOARD */
        .admin-box { background: var(--gray); padding: 15px; border-radius: 8px; margin-bottom: 15px; border: 1px solid #eee; font-size: 0.8rem; }
        .fab { position: fixed; bottom: 25px; right: 25px; width: 60px; height: 60px; background: var(--b); color: #fff; border-radius: 50%; display: none; align-items: center; justify-content: center; font-size: 1.5rem; z-index: 2000; box-shadow: 0 4px 12px rgba(0,0,0,0.2); }

        @media (min-width: 768px) { .grid { grid-template-columns: repeat(4, 1fr); gap: 25px; } }
    </style>
</head>
<body>

    <header>
        <div class="logo" id="boss-key">ESSENCE</div>
        <div class="search-container">
            <input type="text" id="find" class="search-input" placeholder="Buscar fragancia..." onkeyup="filter()">
        </div>
    </header>

    <nav>
        <button class="nav-btn active" onclick="tab('home', this)">Fragancias</button>
        <button class="nav-btn" onclick="tab('trace', this)">Rastreo</button>
        <button class="nav-btn" id="nav-adm" style="display:none;" onclick="tab('adm', this)">Admin</button>
    </nav>

    <section id="home" class="section active"><div class="grid" id="main-grid"></div></section>

    <section id="trace" class="section">
        <div class="admin-box">
            <h3 style="margin-bottom:10px">Consultar pedido</h3>
            <input type="text" id="tr-name" class="search-input" style="background:#fff; border:1px solid #ddd; color:#000" placeholder="Nombre completo">
            <button class="btn-wa" style="margin-top:10px" onclick="tracking()">Consultar Status</button>
        </div>
    </section>

    <section id="adm" class="section">
        <h3 style="margin-bottom:15px">VENTAS REGISTRADAS</h3>
        <div id="sales-log"></div>
        <hr style="margin:20px 0">
        <h3 style="margin-bottom:15px">INVENTARIO</h3>
        <div id="adm-list"></div>
    </section>

    <div class="fab" id="add-btn" onclick="addP()">+</div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-app.js";
        import { getFirestore, collection, addDoc, onSnapshot, updateDoc, deleteDoc, doc, query, orderBy } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-firestore.js";

        const config = {
            apiKey: "AIzaSyBkNAkJXoyxn9rkGv1mG5GPh9ge4FUjp8Y",
            authDomain: "essencev2.firebaseapp.com",
            projectId: "essencev2",
            storageBucket: "essencev2.firebasestorage.app",
            messagingSenderId: "201967001425",
            appId: "1:201967001425:web:0a072cd4d2048e7a0dbd70"
        };

        const app = initializeApp(config);
        const db = getFirestore(app);

        // --- CARGAR PRODUCTOS ---
        onSnapshot(collection(db, "inventario_oficial"), (snap) => {
            const grid = document.getElementById('main-grid');
            const adm = document.getElementById('adm-list');
            grid.innerHTML = ""; adm.innerHTML = "";
            snap.forEach(d => {
                const p = d.data(); const id = d.id;
                const isOut = p.stock === 'off';

                grid.innerHTML += `
                    <div class="card ${isOut ? 'sold-out' : ''}" data-n="${p.name.toLowerCase()}">
                        ${isOut ? '<div class="sold-out-tag">AGOTADO</div>' : ''}
                        <img src="${p.img}">
                        <span class="card-name">${p.name}</span>
                        <span class="card-price">$${p.price}</span>
                        <button class="btn-wa" onclick="${isOut ? '' : `buy('${p.name}', '${p.price}')`}">${isOut ? 'No disponible' : 'Adquirir'}</button>
                    </div>`;
                
                adm.innerHTML += `<div class="admin-box" style="display:flex; justify-content:space-between; align-items:center;">
                    <span>${p.name}</span>
                    <div>
                        <button onclick="tgS('${id}','${p.stock}')" style="padding:4px">Stock</button>
                        <button onclick="del('${id}')" style="color:red; margin-left:10px">X</button>
                    </div>
                </div>`;
            });
        });

        // --- COMPRA DIRECTA WHATSAPP ---
        window.buy = async (name, price) => {
            const user = prompt("Ingrese su nombre para la orden:");
            if(!user) return;

            // Guardar en tu base de datos para el Dashboard
            await addDoc(collection(db, "ventas_essence"), {
                cliente: user, producto: name, fecha: new Date().toLocaleString(), ts: new Date()
            });

            // Enviar a tu WhatsApp (50769028805)
            const text = `ðŸ”¥ *NUEVA ORDEN ESSENCE*%0A%0AðŸ‘¤ *Cliente:* ${user}%0AðŸ“¦ *Fragancia:* ${name}%0AðŸ’° *Precio:* $${price}%0A%0A_Por favor, confÃ­rmame disponibilidad._`;
            window.open(`https://wa.me/50769028805?text=${text}`);
        };

        // --- LOG DE VENTAS PARA DASHBOARD ---
        onSnapshot(query(collection(db, "ventas_essence"), orderBy("ts", "desc")), (snap) => {
            const log = document.getElementById('sales-log');
            log.innerHTML = "";
            snap.forEach(d => {
                const v = d.data();
                log.innerHTML += `<div class="admin-box" style="background:#fff"><b>${v.cliente}</b> pidiÃ³ <b>${v.producto}</b> el ${v.fecha}</div>`;
            });
        });

        // --- FUNCIONES CORE ---
        window.filter = () => {
            const t = document.getElementById('find').value.toLowerCase();
            document.querySelectorAll('.card').forEach(c => c.style.display = c.getAttribute('data-n').includes(t) ? "block" : "none");
        };
        window.tab = (id, b) => {
            document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
            document.querySelectorAll('.nav-btn').forEach(n => n.classList.remove('active'));
            document.getElementById(id).classList.add('active'); b.classList.add('active');
        };
        window.tracking = () => {
            const n = document.getElementById('tr-name').value;
            if(n) window.open(`https://wa.me/50769028805?text=Hola,%20quisiera%20saber%20el%20estatus%20de%20mi%20pedido:%20${n}`);
        };
        window.tgS = (id, s) => updateDoc(doc(db, "inventario_oficial", id), { stock: s === 'off' ? 'on' : 'off' });
        window.del = (id) => confirm("Â¿Borrar?") && deleteDoc(doc(db, "inventario_oficial", id));
        window.addP = async () => {
            const n = prompt("Nombre:"), p = prompt("Precio:"), i = prompt("URL Imagen:");
            if(n && p && i) await addDoc(collection(db, "inventario_oficial"), { name:n, price:p, img:i, stock:'on' });
        };

        let cl = 0;
        document.getElementById('boss-key').onclick = () => {
            if(++cl >= 3) {
                if(prompt("PASSWORD:") === "542497") {
                    document.getElementById('nav-adm').style.display = 'block';
                    document.getElementById('add-btn').style.display = 'flex';
                }
                cl = 0;
            }
        };
    </script>
</body>
</html>








