<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ESSENCE FORCE V1100</title>
    <style>
        body { font-family: sans-serif; text-align: center; padding: 20px; }
        input { display: block; width: 90%; max-width: 300px; margin: 10px auto; padding: 10px; }
        button { padding: 10px 20px; background: #000; color: #fff; border: none; cursor: pointer; }
        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 20px; }
        .card { border: 1px solid #ddd; padding: 10px; }
        .card img { width: 100%; }
    </style>
</head>
<body>

    <h1>ESSENCE DEBUG MODE</h1>
    <p>Si las reglas están en TRUE, este formulario debe escribir en Firebase sí o sí.</p>
    
    <div style="border: 2px solid #000; padding: 20px; display: inline-block;">
        <input id="n" placeholder="Nombre">
        <input id="p" type="number" placeholder="Precio">
        <input id="i" placeholder="URL Imagen">
        <button id="btn" onclick="subir()">FORZAR SUBIDA</button>
    </div>

    <div class="grid" id="lista"></div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-app.js";
        import { getFirestore, collection, addDoc, onSnapshot } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-firestore.js";

        const config = {
            apiKey: "AIzaSyBkNAkJXoyxn9rkGv1mG5GPh9ge4FUjp8Y",
            authDomain: "essencev2.firebaseapp.com",
            projectId: "essencev2",
            storageBucket: "essencev2.firebasestorage.app",
            messagingSenderId: "201967001425",
            appId: "1:201967001425:web:0a072cd4d2048e7a0dbd70"
        };

        const app = initializeApp(config);
        const db = getFirestore(app);
        const col = collection(db, "perfumes_test"); // Usamos una colección nueva para limpiar errores

        // LEER
        onSnapshot(col, (snap) => {
            const lista = document.getElementById('lista');
            lista.innerHTML = "";
            snap.forEach(d => {
                const p = d.data();
                lista.innerHTML += `<div class="card"><img src="${p.i}"><h3>${p.n}</h3><p>$${p.p}</p></div>`;
            });
        });

        // ESCRIBIR
        window.subir = async () => {
            const btn = document.getElementById('btn');
            try {
                btn.innerText = "INTENTANDO...";
                await addDoc(col, {
                    n: document.getElementById('n').value,
                    p: document.getElementById('p').value,
                    i: document.getElementById('i').value
                });
                alert("¡LO LOGRAMOS! REVISA FIREBASE");
                btn.innerText = "FORZAR SUBIDA";
            } catch (e) {
                alert("FIREBASE BLOQUEÓ EL ACCESO: " + e.message);
                btn.innerText = "REINTENTAR";
            }
        };
    </script>
</body>
</html>






